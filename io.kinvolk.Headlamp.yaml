app-id: io.kinvolk.Headlamp
runtime: org.freedesktop.Platform
runtime-version: '22.08'
branch: stable
sdk: org.freedesktop.Sdk
base: org.electronjs.Electron2.BaseApp
base-version: '22.08'
command: run-headlamp.sh
separate-locales: false
rename-desktop-file: headlamp.desktop
rename-icon: headlamp
finish-args:
- --share=ipc
- --socket=x11
- --socket=wayland
- --device=dri
- --share=network
# We use .kube/config to know what clusters/contexts are set up
- --filesystem=~/.kube/config:ro
# It's common to run minikube for experimenting, so it should be fine to read this dir
- --filesystem=~/.minikube:ro
# Config folder
- --filesystem=~/.config/Headlamp:ro
modules:
- name: headlamp
  buildsystem: simple
  build-options:
    env:
      XDG_CACHE_HOME: /run/build/headlamp/flatpak-node/cache
      DEBUG: electron-builder
  sources:
  - type: archive
    url: https://github.com/headlamp-k8s/headlamp/releases/download/v0.15.0/Headlamp-0.15.0-linux-x64.tar.gz
    sha256: 6b3235f9b7d6e97c3a90d7fc4ff43648e2c4073532e0a1cb993a76b7e9fbaf6d
    dest: headlamp
    only-arches:
    - x86_64
  - type: archive
    url: https://github.com/headlamp-k8s/headlamp/releases/download/v0.15.0/Headlamp-0.15.0-linux-arm64.tar.gz
    sha256: f3c55708b54911cca932878f260c687836ededabbb30369d53977c996c593fab
    dest: headlamp
    only-arches:
    - aarch64
  - type: file
    path: ./headlamp.desktop
  - type: shell
    commands:
    - install -Dm644 headlamp.desktop /app/share/applications/headlamp.desktop
  - type: file
    path: ./headlamp.svg
  - type: shell
    commands:
    - install -Dm644 headlamp.svg /app/share/icons/hicolor/scalable/apps/headlamp.svg
  - type: file
    path: ./io.kinvolk.Headlamp.appdata.xml
  - type: shell
    commands:
    - install -Dm644 io.kinvolk.Headlamp.appdata.xml /app/share/appdata/io.kinvolk.Headlamp.appdata.xml
  build-commands:
  - rm ./headlamp/chrome-sandbox
  - install -d /app/headlamp-app/
  - cp -R ./headlamp/* /app/headlamp-app/
- name: start-script
  buildsystem: simple
  sources:
  - type: script
    dest-filename: run-headlamp.sh
    commands:
    # Use zypak to call the electron binary to enable sandboxing and prevents no sandbox error
    - export TMPDIR=$XDG_RUNTIME_DIR/app/$FLATPAK_ID
    - zypak-wrapper /app/headlamp-app/headlamp "$@"
  build-commands:
  # Install the wrapper script to start it.
  - install -Dm 755 run-headlamp.sh /app/bin/run-headlamp.sh
